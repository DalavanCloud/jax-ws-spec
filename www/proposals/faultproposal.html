<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
	<title>Protocol Specific Exception Handling in JAX-RPC</title>
	<meta name="generator" content="BBEdit 7.0.4" />
<style type="text/css">
	/* <![CDATA[ */
	h1 { text-align: center; }

	/* ]]> */
</style>
</head>
<body>
<h1>Protocol Specific Exception Handling in JAX-RPC</h1>

<p>JAX-RPC 1.1 provides the <code>SOAPFaultException</code> runtime exception as a means to communicate SOAP 1.1 specific fault information. Every service method can throw either <code>RemoteException</code> (or a subclass), <code>SOAPFaultException</code> or a service specific exception.</p>

<p>The use of a protocol specific exception allows a service method to influence the serialization of the protocol fault but it ties service methods and clients to a specific protocol. This note outlines an alternate proposal that allows an increased separation between clients, services and the underlying protocol while preserving the ability of service methds to influence the underlying protocol and for clients to extract protocol specific information from it.</p>

<h2>Deprecate <code>SOAPFaultException</code></h2>

<p>The new generic approach removes the need for the existing <code>SOAPFaultException</code>.</p>

<h2>Add Generic Protocol Exception</h2>

<p>Add a new generic protocol exception class.</p>

<pre>public class ProtocolDetailsException extends Exception implements Map {
    ProtocolDetailsException();
    ProtocolDetailsException(Map properties);
    ...
}</pre>

This exception is designed as a holder for protocol specific fault information. Service endpoints are not intended to throw this exception directly.

<h2>Define Subclasses for Supported Protocols</h2>

<p>Add a new subclass of <code>ProtocolDetailsException</code> for each protocol binding defined by JAX-RPC. E.g. for SOAP 1.1 we would define a <code>SOAP11DetailsException</code>.</p>

<h2>Define Properties</h2>
<p>Define a set of properties for each supported protocol.
E.g. for SOAP 1.1 we could have a property called <code>javax.xml.rpc.soap11.faultcode</code> of type <code>QName</code>.</p>

<h2>Server side</h2>
<p>Allow optional use of the new exceptions as the cause for server method exceptions.</p>

<pre>public void doSomethingUseful() throws RemoteException {
    ...
    if (someProblem) {
        HashMap details = new HashMap();
        QName faultcode = new QName(SOAP_ENVELOPE_NAMESPACE, "Client");
        details.put("javax.xml.rpc.soap11.faultcode",faultcode);
        ...
        ProtocolDetailsException pde = new ProtocolDetailsException(details);
        throw new RemoteException("Something went wrong",pde);
    }
    ...
}</pre>

<p>The server side is able to simultaneously specify protocol specific fault information for as many protocols of which it was aware.</p>

<h2>Client side</h2>

<p>Require client side JAX-RPC runtime to create a cause for the protocol (if any - local calls would be exempt from this requirement) on which a fault response was received. The cause would be required to be an instance of the <code>ProtocolDetailsException</code> subclass for the protocol in use, e.g. it would be required to be <code>SOAP11DetailsException</code> when SOAP 1.1 was used. Client code can interrogate the cause of an exception to extract additional protocol specific information if desired.</p>

<pre>try {
    stub.doSomethingUseful();
}
catch (RemoteException e) {
    if (e.getCause() != null) {
        if (e.getCause() instanceof SOAP11DetailsException) {
            SOAP11DetailsException pde = (SOAP11DetailsException)e.getCause();
            QName soap11faultcode = pde.get("javax.xml.rpc.soap11.faultcode");
            ...
        }
        if (e.getCause() instanceof ProtocolDetailsException) {
            ProtocolDetailsException pde = (ProtocolDetailsException)e.getCause();
            // generic ProtocolDetailsException processing
            ...
        }
    }
}</pre>

<p>On the client side only the fault information for the actual protocol used would be available. Additional information for other protocol specified at the server side would not be transferred.</p>

</body>
</html>
